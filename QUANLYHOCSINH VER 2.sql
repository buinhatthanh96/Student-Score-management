USE master
GO
IF EXISTS (SELECT * FROM sysdatabases
			WHERE name = N'Quanlyhocsinh')

DROP DATABASE Quanlyhocsinh

CREATE DATABASE Quanlyhocsinh
GO
USE Quanlyhocsinh
GO
-----BẢNG GIÁO VIÊN CHỦ NHIỆM
IF OBJECT_ID('GVCN') IS NOT NULL
DROP TABLE GVCN
GO
CREATE TABLE GVCN (
MAGVCN NVARCHAR (20) PRIMARY KEY,
TENGVCN NVARCHAR(50),
SDT NVARCHAR(50),
DIACHI NVARCHAR(50),
MALOP NVARCHAR (20),
)
-----BẢNG LỚP
IF OBJECT_ID('LOP') IS NOT NULL
DROP TABLE LOP
GO
CREATE TABLE LOP (
MALOP NVARCHAR (20) PRIMARY KEY,
TENLOP NVARCHAR(50),
)
-----BẢNG STUDENT
IF OBJECT_ID('STUDENT') IS NOT NULL
DROP TABLE STUDENT
GO
CREATE TABLE STUDENT (
MAHS NVARCHAR (20) PRIMARY KEY,
NAME NVARCHAR(50),
MALOP NVARCHAR (20),
EMAIL NVARCHAR(50),
PHONE NVARCHAR(20),
GIOITINH NVARCHAR(20),
DIACHI Nvarchar(100),
AVATAR NVARCHAR(50)
)
-----BẢNG ĐIỂM
IF OBJECT_ID('DIEM') IS NOT  NULL
DROP  TABLE DIEM
GO
CREATE TABLE DIEM (
ID INT PRIMARY KEY,
MAHS NVARCHAR(20), 
TOAN float,
VATLY float,
HOAHOC float,
SINHHOC float,
NGUVAN float,
TIENGANH float,
LICHSU float,
DIALY float
)
-----BẢNG LOGIN HỌC SINH
IF OBJECT_ID('LOGIN_HS') IS NOT NULL
DROP TABLE LOGIN_HS
GO
CREATE TABLE LOGIN_HS(
USERNAME NVARCHAR(20) PRIMARY KEY,
PASS  NVARCHAR(20),
QUYEN NVARCHAR(20),
MAHS NVARCHAR(20)
)
-----BẢNG LOGIN GVCN
IF OBJECT_ID('LOGIN_GVCN') IS NOT NULL
DROP TABLE LOGIN_GVCN
GO
CREATE TABLE LOGIN_GVCN(
USERNAME NVARCHAR(20) PRIMARY KEY,
PASS  NVARCHAR(20),
QUYEN NVARCHAR(20),
MAGVCN NVARCHAR(20)
)
-----KHÓA NGOẠI
ALTER TABLE GVCN ADD CONSTRAINT FK_GVCN_LOP FOREIGN KEY(MALOP) REFERENCES LOP (MALOP)
ALTER TABLE STUDENT ADD CONSTRAINT FK_STUDENT_LOP FOREIGN KEY(MALOP) REFERENCES LOP (MALOP)
ALTER TABLE DIEM ADD CONSTRAINT FK_DIEM_STUDENT FOREIGN KEY(MAHS) REFERENCES STUDENT (MAHS)
ALTER TABLE LOGIN_HS ADD CONSTRAINT FK_LOGIN_HS_STUDENT FOREIGN KEY(MAHS) REFERENCES STUDENT (MAHS)
ALTER TABLE LOGIN_GVCN ADD CONSTRAINT FK_LOGIN_GVCN_GVCN FOREIGN KEY(MAGVCN) REFERENCES GVCN (MAGVCN)


ALTER TABLE LOP ADD CONSTRAINT FK_LOP_GVCN FOREIGN KEY(MAGVCN) REFERENCES GVCN (MAGVCN)
ALTER TABLE STUDENT ADD CONSTRAINT FK_STUDENT_LOP FOREIGN KEY(MALOP) REFERENCES LOP (MALOP)
ALTER TABLE DIEM ADD CONSTRAINT FK_DIEM_STUDENT FOREIGN KEY(MAHS) REFERENCES STUDENT (MAHS)
ALTER TABLE LOGIN ADD CONSTRAINT FK_LOGIN_STUDENT FOREIGN KEY(MANGUOIDUNG) REFERENCES STUDENT (MAHS)

----- TRUY VẤN ----
DELETE FROM LOGIN_HS

SELECT * FROM GVCN
SELECT * FROM LOP
SELECT * FROM STUDENT
SELECT * FROM DIEM
SELECT * FROM LOGIN
GO
---- DU LIEU BẢNG GIÁO VIÊN CHỦ NHIỆM
INSERT INTO GVCN (MAGVCN,TENGVCN,SDT,DIACHI,MALOP) VALUES('GVCN11A7',N'Mai Hồng Loan','0965432234','Krong Nang - DakLak','1107')
INSERT INTO GVCN (MAGVCN,TENGVCN,SDT,DIACHI,MALOP) VALUES('GVCN12A8',N'Trần Kim Liên','0966554433','Ekar - DakLak','1208')

---- DU LIEU BẢNG LỚP
INSERT INTO LOP (MALOP,TENLOP) VALUES('1107','11A7')
INSERT INTO LOP (MALOP,TENLOP) VALUES('1208','12A8')
---- DU LIEU BANG SUDENT
INSERT INTO STUDENT VALUES('111701',N'Nguyễn Kim Ngân',	'1107',	'kimngan@gmail.com',	'0964365479',N'Nữ','GIAO TAN - NAM DINH',	'nguyen kim ngan.jpg')
INSERT INTO STUDENT VALUES('111702',N'Võ Minh Thư',		'1107',	'minhthu@gmail.com',	'0964365479',N'Nữ','PHU THO - VIET NAM',	'vo minh thu.jpg')
INSERT INTO STUDENT VALUES('111703',N'Lê Thanh Thúy',	'1107',	'thanhthuy@gmail.com',	'0964365479',N'Nữ','HOAI DUC - HA NOI',		'le thanh thuy.jpg')
INSERT INTO STUDENT VALUES('111704',N'Nguyễn Mỹ Linh',	'1107',	'mylinh@gmail.com',		'0964365479',N'Nữ','BA VI - HA NOI',		'nguyen my linh.jpg')
INSERT INTO STUDENT VALUES('121801',N'Vũ Uyên Nhi',		'1208',	'uyennhi@gmail.com',	'0964365479',N'Nữ','GIAO TAN - NAM DINH',	'vu uyen nhi.jpg')
INSERT INTO STUDENT VALUES('121802',N'Đoàn Dự',			'1208',	'doandu@gmail.com',		'0964365479',N'Nam','DAK LAK - VIET NAM',	'doan du.jpg')
INSERT INTO STUDENT VALUES('121803',N'Hoàng Thúy Hằng',	'1208',	'thuyhang@gmail.com',	'0964365479',N'Nữ','PHU THO - VIET NAM',	'hoang thuy hang.jpg')
INSERT INTO STUDENT VALUES('121804',N'Trần Mỹ Uyên',	'1208',	'myuyen@gmail.com',		'0964365479',N'Nữ','HOAI DUC - HA NOI',		'tran my uyen.jpg')
INSERT INTO STUDENT VALUES('121805',N'Mai Kiều Như',	'1208',	'kieunhu@gmail.com',	'0964365479',N'Nữ','BA VI - HA NOI',		'mai kieu nhu.jpg')

------------ CHEN DU LIEU VA BANG DIEM -  ------
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(1,'111701',8,9,7,8,5,7,6,9)
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(2,'111702',7,8,5,7,8,9,7,8)
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(3,'111703',8,9,10,7,8,6,7,8)
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(4,'111704',5,7,6,8,7,6,9,8)
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(5,'121801',5,7,8,9,7,9,10,7)
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(6,'121802',8,5,8,6,7,9,10,7)
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(7,'121803',8,5,8,6,8,7,6,7)
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(8,'121804',8,8,5,7,8,9,10,7)
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES(9,'121805',10,7,8,6,7,8,10,7)
-------------- DU LIEU BANG  LOGIN GVCN -----------------
INSERT INTO LOGIN_GVCN(USERNAME,PASS,QUYEN,MAGVCN) VALUES('hongloan','123',0,'GVCN11A7')
INSERT INTO LOGIN_GVCN(USERNAME,PASS,QUYEN,MAGVCN) VALUES('kimlien','123',0,'GVCN12A8')
-------------- DU LIEU BANG  LOGIN HỌC SINH--------------
-----------------------LỚP 11A7--------------------------
INSERT INTO LOGIN_HS(USERNAME,PASS,QUYEN,MAHS) VALUES('nguyenkimngan','123',1,'111701')
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('vominhthu','123',1,'111702')
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('lethanhthuy','123',1,'111703')
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('nguyenmylinh','123',1,'111704')
-----------------------LỚP 12A8--------------------------
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('vuuyennhi','123',1,'121801')
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('doandu','123',1,'121802')
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('hoangthuyhang','123',1,'121803')
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('tranmyuyen','123',1,'121804')
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('maikieunhu','123',1,'121805')


--Query DB Login
SELECT USERNAME,PASS,QUYEN,STUDENT.MALOP
FROM LOGIN_HS,STUDENT
WHERE LOGIN_HS.MAHS=STUDENT.MAHS

SELECT USERNAME,PASS,QUYEN,GVCN.MALOP
FROM LOGIN_GVCN,GVCN
WHERE LOGIN_GVCN.MAGVCN=GVCN.MAGVCN
--Query QLHS
----Get DB Hoc Sinh
SELECT * FROM STUDENT WHERE STUDENT.MALOP=?
----Delete Hoc Sinh
DELETE FROM STUDENT WHERE MAHS = ?
----Add Hoc Sinh
INSERT INTO STUDENT VALUES(?,?,?,?,?,?,?,?)
----Khởi tạo điểm HS
INSERT INTO DIEM (ID,MAHS,TOAN,VATLY,HOAHOC,SINHHOC,NGUVAN,TIENGANH,LICHSU,DIALY) VALUES (?,?,0,0,0,0,0,0,0,0)
----getidDBDiem
SELECT COUNT (DIEM.ID) SOLUONG_ID
FROM STUDENT, DIEM, LOP
WHERE DIEM.MAHS=STUDENT.MAHS
AND STUDENT.MALOP=LOP.MALOP
AND LOP.MALOP=?
----Update DB Hoc Sinh
UPDATE STUDENT SET MAHS = ? ,NAME = ? , MALOP = ?, EMAIL = ? , PHONE = ? , GIOITINH = ? ,DIACHI = ?  WHERE MAHS = ?

--Query QL Điểm
----Get DB Điểm
SELECT STUDENT.MAHS, STUDENT.NAME, LOP.TENLOP,
                            DIEM.TOAN, DIEM.VATLY, DIEM.HOAHOC, DIEM.SINHHOC, DIEM.NGUVAN, DIEM.TIENGANH, DIEM.LICHSU, DIEM.DIALY
                            FROM STUDENT, DIEM, LOP
                            WHERE DIEM.MAHS=STUDENT.MAHS
                            AND STUDENT.MALOP=LOP.MALOP AND LOP.MALOP=?
----

SELECT LOGIN_HS.MAHS, STUDENT.NAME, LOGIN_HS.USERNAME, LOGIN_HS.PASS
FROM LOGIN_HS, STUDENT
WHERE LOGIN_HS.MAHS=STUDENT.MAHS AND STUDENT.MALOP=1107

SELECT * FROM LOGIN_HS

DELETE FROM LOGIN_HS WHERE MAHS='121805'
INSERT INTO LOGIN_HS (USERNAME,PASS,QUYEN,MAHS) VALUES('maikieunhu','123',1,'121805')
UPDATE LOGIN_HS SET USERNAME = 'maikieunhu' , PASS = '1234', QUYEN = 1, MAHS = '121805' WHERE MAHS='121805'

